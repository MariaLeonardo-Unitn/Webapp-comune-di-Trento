{"ast":null,"code":"import React,{useState,useEffect}from'react';import'./styles/Prenotazioni_index.css';import{useNavigate}from'react-router-dom';import API_BASE_URL from\"./config\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function PrenotazioniPage(){const navigate=useNavigate();const handleRedirect=()=>{navigate('/menu');};useEffect(()=>{const token=localStorage.getItem(\"token\");if(!token){navigate(\"/login\");}},[navigate]);const[user,setUser]=useState(null);const[formData,setFormData]=useState({date:\"\",quantity:\"\",puntoRitiro:\"Trento Centro\",bagType:\"secco\"});const fetchUser=async()=>{const token=localStorage.getItem(\"token\");if(!token){alert(\"Utente non loggato.\");return;}try{const response=await fetch(API_BASE_URL+\"/api/auth/me\",{method:\"GET\",headers:{\"access-token\":token,\"Content-Type\":\"application/json\"}});console.log('Token inviato:',localStorage.getItem('token'));if(response.ok){const userData=await response.json();setUser(userData);}else{const errorData=await response.json();alert(errorData.error||\"Errore nel recupero dei dati dell'utente.\");}}catch(error){console.error(\"Errore durante la richiesta:\",error);alert(\"Errore nella comunicazione con il server.\");}};useEffect(()=>{fetchUser();},[]);const handleChange=e=>{setFormData({...formData,[e.target.name]:e.target.value});};const handleSubmit=async e=>{e.preventDefault();const dataToSend={tipoSacchetto:formData.bagType,quantita:formData.quantity,dataPrenotazione:formData.date,puntoRitiro:formData.puntoRitiro};const response=await fetch(API_BASE_URL+\"/api/prenotazione\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",'access-token':localStorage.getItem('token')},body:JSON.stringify(dataToSend)});if(response.ok){alert(\"Prenotazione effettuata con successo!\");setFormData({date:\"\",quantity:\"\",puntoRitiro:\"Trento Centro\",bagType:\"secco\"});}else{alert(\"Errore nell'invio della prenotazione\");}};if(!user){return/*#__PURE__*/_jsx(\"div\",{children:\"Caricamento...\"});}return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleRedirect,class:\"back-button\",children:/*#__PURE__*/_jsx(\"img\",{src:\"https://cdn-icons-png.flaticon.com/128/507/507257.png\",alt:\"Back to Interfaccia DA\",style:{width:'30px',height:'30px'}})}),/*#__PURE__*/_jsx(\"h1\",{className:\"fade-in\",children:\"Prenotazioni\"}),/*#__PURE__*/_jsxs(\"form\",{id:\"reservation-form\",className:\"fade-in\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"date\",children:\"Data Prenotazione:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",id:\"date\",name:\"date\",value:formData.date,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"quantity\",children:\"Numero di sacchetti:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",id:\"quantity\",name:\"quantity\",value:formData.quantity,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"puntoRitiro\",children:\"Punto di ritiro\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"puntoRitiro\",name:\"puntoRitiro\",value:formData.puntoRitiro,onChange:handleChange,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"Trento Centro\",children:\"Trento Centro\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Cristo Re\",children:\"Cristo Re\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Tangenziale\",children:\"Tangenziale\"})]}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"bagType\",children:\"Tipo:\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"bagType\",name:\"bagType\",value:formData.bagType,onChange:handleChange,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"secco\",children:\"Secco\"}),/*#__PURE__*/_jsx(\"option\",{value:\"umido\",children:\"Umido\"}),/*#__PURE__*/_jsx(\"option\",{value:\"plastica\",children:\"Plastica\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Prenota\"})]})]})});}export default PrenotazioniPage;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","API_BASE_URL","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","PrenotazioniPage","navigate","handleRedirect","token","localStorage","getItem","user","setUser","formData","setFormData","date","quantity","puntoRitiro","bagType","fetchUser","alert","response","fetch","method","headers","console","log","ok","userData","json","errorData","error","handleChange","e","target","name","value","handleSubmit","preventDefault","dataToSend","tipoSacchetto","quantita","dataPrenotazione","body","JSON","stringify","children","onClick","class","src","alt","style","width","height","className","id","onSubmit","htmlFor","type","onChange","required"],"sources":["/root/UNIVERSITA/Webapp-comune-di-Trento/app-react/src/PrenotazioniPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport './styles/Prenotazioni_index.css';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport API_BASE_URL from \"./config\";\r\n\r\nfunction PrenotazioniPage() {\r\n  const navigate = useNavigate();\r\n\r\n  const handleRedirect = () => {\r\n    navigate('/menu');\r\n  };\r\n  \r\n\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\"token\");\r\n\r\n    if (!token) {\r\n      navigate(\"/login\");\r\n    }\r\n  }, [navigate]);\r\n\r\n  const [user, setUser] = useState(null);\r\n  const [formData, setFormData] = useState({\r\n    date: \"\",\r\n    quantity: \"\",\r\n    puntoRitiro: \"Trento Centro\",\r\n    bagType: \"secco\"\r\n  });\r\n\r\n  const fetchUser = async () => {\r\n    const token = localStorage.getItem(\"token\");\r\n    if (!token) {\r\n      alert(\"Utente non loggato.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(API_BASE_URL + \"/api/auth/me\", {\r\n        method: \"GET\",\r\n        headers: {\r\n          \"access-token\": token,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      });\r\n      console.log('Token inviato:', localStorage.getItem('token'));\r\n      if (response.ok) {\r\n        const userData = await response.json();\r\n        setUser(userData);\r\n      } else {\r\n        const errorData = await response.json();\r\n        alert(errorData.error || \"Errore nel recupero dei dati dell'utente.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Errore durante la richiesta:\", error);\r\n      alert(\"Errore nella comunicazione con il server.\");\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchUser();\r\n  }, []);\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({\r\n      ...formData,\r\n      [e.target.name]: e.target.value,\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    const dataToSend = {\r\n      tipoSacchetto: formData.bagType,\r\n      quantita: formData.quantity,\r\n      dataPrenotazione: formData.date,\r\n      puntoRitiro: formData.puntoRitiro\r\n    };\r\n    const response = await fetch(API_BASE_URL + \"/api/prenotazione\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        'access-token': localStorage.getItem('token')\r\n      },\r\n      body: JSON.stringify(dataToSend),\r\n    });\r\n\r\n    if (response.ok) {\r\n      alert(\"Prenotazione effettuata con successo!\");\r\n      setFormData({date: \"\", quantity: \"\", puntoRitiro: \"Trento Centro\", bagType: \"secco\" }); \r\n    } else {\r\n      alert(\"Errore nell'invio della prenotazione\");\r\n    }\r\n  };\r\n\r\n  if (!user) {\r\n    return <div>Caricamento...</div>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div> \r\n      <button onClick={handleRedirect} class=\"back-button\">\r\n        <img\r\n          src=\"https://cdn-icons-png.flaticon.com/128/507/507257.png\"\r\n          alt=\"Back to Interfaccia DA\"\r\n          style={{ width: '30px', height: '30px' }}\r\n        />\r\n      </button>\r\n        <h1 className=\"fade-in\">Prenotazioni</h1>\r\n        <form id=\"reservation-form\" className=\"fade-in\" onSubmit={handleSubmit}>\r\n          <label htmlFor=\"date\">Data Prenotazione:</label>\r\n          <input type=\"date\" id=\"date\" name=\"date\" value={formData.date} onChange={handleChange} required />\r\n          <label htmlFor=\"quantity\">Numero di sacchetti:</label>\r\n          <input type=\"number\" id=\"quantity\" name=\"quantity\" value={formData.quantity} onChange={handleChange} required />\r\n          <label htmlFor=\"puntoRitiro\">Punto di ritiro</label>\r\n          <select id=\"puntoRitiro\" name=\"puntoRitiro\" value={formData.puntoRitiro} onChange={handleChange} required>\r\n            <option value=\"Trento Centro\">Trento Centro</option>\r\n            <option value=\"Cristo Re\">Cristo Re</option>\r\n            <option value=\"Tangenziale\">Tangenziale</option>\r\n          </select>\r\n          <label htmlFor=\"bagType\">Tipo:</label>\r\n          <select id=\"bagType\" name=\"bagType\" value={formData.bagType} onChange={handleChange} required>\r\n            <option value=\"secco\">Secco</option>\r\n            <option value=\"umido\">Umido</option>\r\n            <option value=\"plastica\">Plastica</option>\r\n          </select>\r\n          <button type=\"submit\">Prenota</button>\r\n        </form>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\nexport default PrenotazioniPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}