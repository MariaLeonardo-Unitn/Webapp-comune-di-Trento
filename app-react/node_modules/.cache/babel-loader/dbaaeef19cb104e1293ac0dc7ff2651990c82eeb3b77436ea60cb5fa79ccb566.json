{"ast":null,"code":"import React,{useState}from'react';import{useNavigate}from'react-router-dom';import'./styles/Login.css';import API_BASE_URL from\"./config\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function Register(){const[message,setMessage]=useState('');const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[codiceFiscale,setCodiceFiscale]=useState('');const[nome,setNome]=useState('');const[cognome,setCognome]=useState('');const[role,setRole]=useState('cittadino');const[secret_token,setSecretToken]=useState('');const navigate=useNavigate();const handleSubmit=async event=>{event.preventDefault();const userData={nome,cognome,email,password,codiceFiscale,role,...(role!=='cittadino'&&{secret_token})};try{const response=await fetch(API_BASE_URL+'/api/auth/signup',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(userData)});const data=await response.json();if(response.ok){alert(\"Registrazione avvenuta con successo!\");setNome('');setCognome('');setCodiceFiscale('');setEmail('');setPassword('');setRole('cittadino');setSecretToken('');handleLogin({email,password});}else{setMessage(`Errore: ${data.error||'Registrazione fallita'}`);alert(\"Registrazione fallita\");}}catch(error){setMessage('Errore di connessione al server.');console.error('Errore:',error);}};const handleLogin=async credentials=>{try{const response=await fetch(API_BASE_URL+\"/api/auth/login\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(credentials)});const data=await response.json();if(!response.ok){throw new Error(\"Errore di login\");}if(data.token){localStorage.setItem(\"token\",data.token);localStorage.setItem(\"role\",data.role);localStorage.setItem(\"utenteId\",data.utenteId);if(data.role===\"operatore_Dolomiti\"){navigate(\"/interfacciaDA\");}else if(data.role===\"operatore_comune\"){navigate(\"/interfacciaC\");}else{navigate(\"/menu\");}}}catch(error){console.error(\"Errore durante il login:\",error);setMessage(\"Errore di login dopo la registrazione.\");}};const handleChangeRole=e=>{setRole(e.target.value);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"fade-in\",children:\"Registrati\"}),/*#__PURE__*/_jsxs(\"form\",{id:\"reservation-form\",className:\"slide-in\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"nome\",children:\"Nome:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"nome\",name:\"nome\",type:\"text\",value:nome,onChange:e=>setNome(e.target.value),required:true}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"cognome\",children:\"Cognome:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"cognome\",name:\"cognome\",type:\"text\",value:cognome,onChange:e=>setCognome(e.target.value),required:true}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"codiceFiscale\",children:\"Codice Fiscale:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"codiceFiscale\",name:\"codiceFiscale\",type:\"text\",value:codiceFiscale,onChange:e=>setCodiceFiscale(e.target.value),required:true}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"email\",children:\"Email:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"email\",name:\"email\",type:\"email\",value:email,onChange:e=>setEmail(e.target.value),required:true}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",children:\"Password:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"password\",name:\"password\",type:\"password\",value:password,onChange:e=>setPassword(e.target.value),required:true}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"role\",children:\"Seleziona il tuo ruolo:\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"role\",name:\"role\",value:role,onChange:handleChangeRole,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"cittadino\",children:\"Cittadino\"}),/*#__PURE__*/_jsx(\"option\",{value:\"operatore_Dolomiti\",children:\"Operatore Dolomiti Ambiente\"}),/*#__PURE__*/_jsx(\"option\",{value:\"operatore_comune\",children:\"Operatore comunale\"})]}),role==='operatore_Dolomiti'||role==='operatore_comune'?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"secret_token\",children:\"Codice Operatore:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"secret_token\",name:\"secret_token\",type:\"text\",value:secret_token,onChange:e=>setSecretToken(e.target.value)})]}):null,/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Invia\"})]})]});}export default Register;","map":{"version":3,"names":["React","useState","useNavigate","API_BASE_URL","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Register","message","setMessage","email","setEmail","password","setPassword","codiceFiscale","setCodiceFiscale","nome","setNome","cognome","setCognome","role","setRole","secret_token","setSecretToken","navigate","handleSubmit","event","preventDefault","userData","response","fetch","method","headers","body","JSON","stringify","data","json","ok","alert","handleLogin","error","console","credentials","Error","token","localStorage","setItem","utenteId","handleChangeRole","e","target","value","children","className","id","onSubmit","htmlFor","name","type","onChange","required"],"sources":["/root/UNIVERSITA/Webapp-comune-di-Trento/app-react/src/Register.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport './styles/Login.css'; \r\nimport API_BASE_URL from \"./config\";\r\n\r\n\r\nfunction Register() {\r\n  const [message, setMessage] = useState('');\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [codiceFiscale, setCodiceFiscale] = useState('');\r\n  const [nome, setNome] = useState('');\r\n  const [cognome, setCognome] = useState('');\r\n  const [role, setRole] = useState('cittadino');\r\n  const [secret_token, setSecretToken] = useState('');\r\n  const navigate = useNavigate();\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n\r\n    const userData = {\r\n      nome,\r\n      cognome,\r\n      email,\r\n      password,\r\n      codiceFiscale,\r\n      role,\r\n      ...(role !== 'cittadino' && { secret_token }) \r\n    };\r\n\r\n    try {\r\n      const response = await fetch(API_BASE_URL + '/api/auth/signup', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(userData)\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (response.ok) {\r\n        alert(\"Registrazione avvenuta con successo!\");\r\n\r\n        setNome('');\r\n        setCognome('');\r\n        setCodiceFiscale('');\r\n        setEmail('');\r\n        setPassword('');\r\n        setRole('cittadino');\r\n        setSecretToken('');\r\n\r\n        handleLogin({ email, password });\r\n      } else {\r\n        setMessage(`Errore: ${data.error || 'Registrazione fallita'}`);\r\n        alert(\"Registrazione fallita\");\r\n      }\r\n    } catch (error) {\r\n      setMessage('Errore di connessione al server.');\r\n      console.error('Errore:', error);\r\n    }\r\n  };\r\n\r\n  const handleLogin = async (credentials) => {\r\n    try {\r\n      const response = await fetch(API_BASE_URL + \"/api/auth/login\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(credentials),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\"Errore di login\");\r\n      }\r\n\r\n      if (data.token) {\r\n        localStorage.setItem(\"token\", data.token);\r\n        localStorage.setItem(\"role\", data.role);\r\n        localStorage.setItem(\"utenteId\", data.utenteId);\r\n\r\n        if (data.role === \"operatore_Dolomiti\") {\r\n          navigate(\"/interfacciaDA\");\r\n        } else if (data.role === \"operatore_comune\") {\r\n          navigate(\"/interfacciaC\");\r\n        } else {\r\n          navigate(\"/menu\");\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Errore durante il login:\", error);\r\n      setMessage(\"Errore di login dopo la registrazione.\");\r\n    }\r\n  };\r\n\r\n  const handleChangeRole = (e) => {\r\n    setRole(e.target.value);\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h1 className=\"fade-in\">Registrati</h1>\r\n      <form id=\"reservation-form\" className=\"slide-in\" onSubmit={handleSubmit}>\r\n      \r\n        <label htmlFor=\"nome\">Nome:</label>\r\n        <input\r\n          id=\"nome\"\r\n          name=\"nome\"\r\n          type=\"text\"\r\n          value={nome}\r\n          onChange={(e) => setNome(e.target.value)}\r\n          required\r\n        />\r\n        <label htmlFor=\"cognome\">Cognome:</label>\r\n        <input\r\n          id=\"cognome\"\r\n          name=\"cognome\"\r\n          type=\"text\"\r\n          value={cognome}\r\n          onChange={(e) => setCognome(e.target.value)}\r\n          required\r\n        />\r\n        <label htmlFor=\"codiceFiscale\">Codice Fiscale:</label>\r\n        <input\r\n          id=\"codiceFiscale\"\r\n          name=\"codiceFiscale\"\r\n          type=\"text\"\r\n          value={codiceFiscale}\r\n          onChange={(e) => setCodiceFiscale(e.target.value)}\r\n          required\r\n        />\r\n        <label htmlFor=\"email\">Email:</label>\r\n        <input\r\n          id=\"email\"\r\n          name=\"email\"\r\n          type=\"email\"\r\n          value={email}\r\n          onChange={(e) => setEmail(e.target.value)}\r\n          required\r\n        />\r\n\r\n        <label htmlFor=\"password\">Password:</label>\r\n        <input\r\n          id=\"password\"\r\n          name=\"password\"\r\n          type=\"password\"\r\n          value={password}\r\n          onChange={(e) => setPassword(e.target.value)}\r\n          required\r\n        />\r\n        <label htmlFor=\"role\">Seleziona il tuo ruolo:</label>\r\n        <select id=\"role\" name=\"role\" value={role} onChange={handleChangeRole} required>\r\n          <option value=\"cittadino\">Cittadino</option>\r\n          <option value=\"operatore_Dolomiti\">Operatore Dolomiti Ambiente</option>\r\n          <option value=\"operatore_comune\">Operatore comunale</option>\r\n        </select>\r\n\r\n        {role === 'operatore_Dolomiti' || role === 'operatore_comune' ? (\r\n          <>\r\n            <label htmlFor=\"secret_token\">Codice Operatore:</label>\r\n            <input\r\n              id=\"secret_token\"\r\n              name=\"secret_token\"\r\n              type=\"text\"\r\n              value={secret_token}\r\n              onChange={(e) => setSecretToken(e.target.value)}\r\n            />\r\n          </>\r\n        ) : null}\r\n\r\n        <button type=\"submit\">Invia</button>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Register;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}