{"ast":null,"code":"import React,{useEffect}from\"react\";import{useLocation,useNavigate}from\"react-router-dom\";import\"./styles/Segnalazioni.css\";import API_BASE_URL from\"./config\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Segnalazioni=()=>{var _location$state;const location=useLocation();const coords=(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.coords;const navigate=useNavigate();useEffect(()=>{const token=localStorage.getItem(\"token\");if(!token){navigate(\"/login\");}},[navigate]);useEffect(()=>{const h1Element=document.querySelector(\"h1\");const formElement=document.querySelector(\"form\");if(h1Element&&formElement){h1Element.classList.add(\"fade-in\");formElement.classList.add(\"slide-in\");}},[]);if(!coords||!coords.lat||!coords.lng){return/*#__PURE__*/_jsx(\"div\",{children:\"Posizione non disponibile. Si prega di selezionare una posizione sulla mappa.\"});}const handleSubmit=async event=>{event.preventDefault();const formData=new FormData();const photo=event.target.photo.files[0];const token=localStorage.getItem(\"token\");if(!coords.lat||!coords.lng){return;}if(!token){alert(\"Errore: utente non autenticato.\");return;}if(!photo){alert(\"Errore: nessuna foto selezionata.\");return;}formData.append(\"foto\",photo);formData.append(\"utenteId\",localStorage.getItem(\"utenteId\"));formData.append(\"lat\",coords.lat);formData.append(\"lng\",coords.lng);formData.append(\"descrizione\",event.target.reason.value);try{const response=await fetch(API_BASE_URL+\"/api/segnalazioni\",{method:\"POST\",headers:{\"access-token\":token},body:formData});if(response.ok){alert(`Segnalazione inviata con successo!`);}else{alert(\"Errore nell'invio della segnalazione.\");}}catch(error){console.error(\"Errore:\",error);alert(\"Errore di connessione con il server.\");}};return/*#__PURE__*/_jsxs(\"div\",{className:\"segnalazioni-container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Segnalazioni\"}),/*#__PURE__*/_jsxs(\"form\",{id:\"reservation-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"reason\",children:\"Motivo Segnalazione:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"reason\",name:\"reason\",required:true}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"photo\",children:\"Carica una fotografia :\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"photo\",name:\"photo\",accept:\"image/*\",required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Invia\"})]})]});};export default Segnalazioni;","map":{"version":3,"names":["React","useEffect","useLocation","useNavigate","API_BASE_URL","jsx","_jsx","jsxs","_jsxs","Segnalazioni","_location$state","location","coords","state","navigate","token","localStorage","getItem","h1Element","document","querySelector","formElement","classList","add","lat","lng","children","handleSubmit","event","preventDefault","formData","FormData","photo","target","files","alert","append","reason","value","response","fetch","method","headers","body","ok","error","console","className","id","onSubmit","htmlFor","name","required","type","accept"],"sources":["/root/UNIVERSITA/Webapp-comune-di-Trento/app-react/src/Segnalazioni.js"],"sourcesContent":["import React, { useEffect } from \"react\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport \"./styles/Segnalazioni.css\";\r\nimport API_BASE_URL from \"./config\";\r\n\r\n\r\nconst Segnalazioni = () => {\r\n  const location = useLocation();\r\n  const coords = location.state?.coords;\r\n  const navigate = useNavigate();\r\n  \r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\"token\");\r\n\r\n    if (!token) {\r\n      navigate(\"/login\");\r\n    }\r\n  }, [navigate]);\r\n\r\n  useEffect(() => {\r\n    const h1Element = document.querySelector(\"h1\");\r\n    const formElement = document.querySelector(\"form\");\r\n\r\n    if (h1Element && formElement) {\r\n      h1Element.classList.add(\"fade-in\");\r\n      formElement.classList.add(\"slide-in\");\r\n    }\r\n  }, []);\r\n  if (!coords || !coords.lat || !coords.lng) {\r\n    return <div>Posizione non disponibile. Si prega di selezionare una posizione sulla mappa.</div>;\r\n  }\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n    const formData = new FormData();\r\n    const photo = event.target.photo.files[0];\r\n    const token = localStorage.getItem(\"token\"); \r\n\r\n    if (!coords.lat || !coords.lng) {\r\n      return;\r\n    }\r\n    if (!token) {\r\n        alert(\"Errore: utente non autenticato.\");\r\n        return;\r\n    }\r\n    if (!photo) {\r\n        alert(\"Errore: nessuna foto selezionata.\");\r\n        return;\r\n    }\r\n    formData.append(\"foto\", photo);\r\n    formData.append(\"utenteId\", localStorage.getItem(\"utenteId\"));\r\n    formData.append(\"lat\", coords.lat);\r\n    formData.append(\"lng\", coords.lng);\r\n    formData.append(\"descrizione\", event.target.reason.value);\r\n\r\n    try {\r\n      const response = await fetch(API_BASE_URL + \"/api/segnalazioni\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"access-token\": token\r\n        },\r\n        body: formData\r\n      });\r\n\r\n      if (response.ok) {\r\n        alert(`Segnalazione inviata con successo!`);\r\n      } else {\r\n        alert(\"Errore nell'invio della segnalazione.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Errore:\", error);\r\n      alert(\"Errore di connessione con il server.\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"segnalazioni-container\">\r\n      <h1>Segnalazioni</h1>\r\n      <form id=\"reservation-form\" onSubmit={handleSubmit}>\r\n        <label htmlFor=\"reason\">Motivo Segnalazione:</label>\r\n        <input id=\"reason\" name=\"reason\" required/>\r\n\r\n        <label htmlFor=\"photo\">Carica una fotografia :</label>\r\n        <input\r\n          type=\"file\"\r\n          id=\"photo\"\r\n          name=\"photo\"\r\n          accept=\"image/*\" \r\n          required\r\n        />\r\n\r\n        <button type=\"submit\">Invia</button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Segnalazioni;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}